# ECON HISTORY - ASSIGNMENT 2

### Benramdane, Blanchon, Garson, Maestri

## 0. Importing libraries and inspectioning data

```{r}
#install.packages("tidyverse")
#install.packages("skimr")
#install.packages("stargazer")
#install.packages("sandwich")
#install.packages("aod")
library(tidyverse)
library(skimr)
library(stargazer)
library(sandwich)
library(aod)
library(countrycode)
jst_data <- read.csv('./JSTdatasetR6.csv')
names(jst_data)[0:5]
```

## 1. Estimate first logit model

### a. Select and refine data for logit model

```{r}
logit_data <- jst_data %>%
  arrange(country, year) %>%
  mutate(tloans_real = tloans/cpi, 
         ln_tloans_real = log(tloans_real),
         year = as.integer(year),
         .after = tloans) %>%
  mutate(ln_diff_tloans = ln_tloans_real - lag(ln_tloans_real, n=1),
         .after = ln_tloans_real) %>%
  select(country, year, crisisJST,
         tloans_real, ln_tloans_real, 
         ln_diff_tloans, tloans, cpi)
```

#### b. Running the logit model and exporting results

```{r}
#Compute model
logit_credit <- glm(crisisJST ~ lag(ln_diff_tloans, 1) +
                      lag(ln_diff_tloans, 2) + 
                      lag(ln_diff_tloans, 3) + 
                      lag(ln_diff_tloans, 4) + 
                      lag(ln_diff_tloans, 5) +
                      factor(country),
                    family = binomial(link = "logit"),
                    data = logit_data)

#Plot results
stargazer(logit_credit,
          type = "text",
          align = TRUE,
          omit = c("country"))
```

#### c. Test for joint significance of lagged variables

```{r}
# Perform Wald test
wald.test(
  b = coef(logit_credit),             # Coefficients from the full model
  Sigma = vcov(logit_credit),         # Variance-covariance matrix of the coefficients
  Terms = 2:6                       # Indices of lagged predictors in the model
)
```

#### d. Import BVX crisis list and merge with JST data

```{r}
#Use countrycodes to merge
jst_data$countrycode <- countrycode(jst_data$country, 
                                    origin = "country.name", 
                                    destination = "iso3c")

#Read BVX data
bvx_crises <- read.csv("./bvx_crises_list.csv") %>%
  select(country, year, bvx_crisis)
bvx_logit_data <- left_join(logit_data, bvx_crises, by = join_by(country, year))
```

#### e. Estimate logit model for BVX crises

```{r}
#Compute model
bvx_logit_credit <- glm(bvx_crisis ~ lag(ln_diff_tloans, 1) +
                      lag(ln_diff_tloans, 2) + 
                      lag(ln_diff_tloans, 3) + 
                      lag(ln_diff_tloans, 4) + 
                      lag(ln_diff_tloans, 5) +
                        factor(country),
                    family = binomial(link = "logit"),
                    data = bvx_logit_data)

#Plot results
stargazer(bvx_logit_credit,
          type = "text",
          align = TRUE,
          omit = c("country"))
```

#### f. Test for joint significance of lagged variables in BVX crises subset

```{r}
# Perform Wald test
wald.test(
  b = coef(bvx_logit_credit),             # Coefficients from the full model
  Sigma = vcov(bvx_logit_credit),         # Variance-covariance matrix of the coefficients
  Terms = 2:6                       # Indices of lagged predictors in the model
)
```
